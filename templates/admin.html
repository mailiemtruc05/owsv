<!DOCTYPE html>
<html>
  <head>
    <title>Admin - Qu·∫£n l√Ω danh s√°ch m√°y</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        padding: 20px;
      }

      h1,
      h2 {
        color: #333;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }

      table,
      th,
      td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: center;
      }

      th {
        background: #4caf50;
        color: white;
      }

      button {
        background: #4caf50;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 5px;
      }

      button:hover {
        background: #367c39;
      }

      .delete-btn {
        background: red;
      }

      .delete-btn:hover {
        background: darkred;
      }

      input {
        padding: 5px;
        margin-right: 10px;
      }

      .flash {
        color: green;
        font-weight: bold;
        margin-bottom: 10px;
      }

      form {
        display: inline;
      }

      .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-weight: bold;
        color: white;
        font-size: 14px;
      }

      .status-ok {
        background-color: #4caf50;
      }

      .status-expired {
        background-color: #f44336;
      }

      .status-permanent {
        background-color: #2196f3;
      }
    </style>
  </head>

  <body>
    <h1>Qu·∫£n l√Ω danh s√°ch m√°y h·ª£p l·ªá</h1>

    {% with messages = get_flashed_messages() %} 
    {% if messages %}
    <div class="flash">{{ messages[0] }}</div>
    {% endif %}
    {% endwith %}

    <h2>Danh s√°ch m√°y ch·ªù duy·ªát</h2>
    <table>
      <tr>
        <th>Discord Name</th>
        <th>Hostname</th>
        <th>UUID</th>
        <th>T√™n Tool</th>
        <th>H·∫øt h·∫°n</th>
        <th>H√†nh ƒë·ªông</th>
      </tr>
      {% for machine in pending_machines %}
      <tr>
        <form action="/approve_machine/{{ machine.uuid }}/{{ machine.tool_name }}" method="post">
          <td><input type="text" name="discord_name" placeholder="Discord Name" value="{{ machine.discord_name or '' }}"></td>
          <td>{{ machine.hostname }}</td>
          <td>{{ machine.uuid }}</td>
          <td>{{ machine.tool_name }}</td>
          <td><input type="datetime-local" name="expiry_date" required /></td>
          <td>
            <button type="submit">‚úîÔ∏è Duy·ªát</button>
            <a href="/delete_pending/{{ machine.uuid }}/{{ machine.tool_name }}">
              <button class="delete-btn" type="button">‚ùå X√≥a</button>
            </a>
          </td>
        </form>
      </tr>
      {% endfor %}
    </table>

    <h2>Danh s√°ch m√°y h·ª£p l·ªá</h2>
    <table>
      <tr>
        <th>Discord Name</th>
        <th>Hostname</th>
        <th>UUID</th>
        <th>T√™n Tool</th>
        <th>Ng√†y h·∫øt h·∫°n</th>
        <th>Tr·∫°ng th√°i</th>
        <th>H√†nh ƒë·ªông</th>
      </tr>
      {% for machine in allowed_machines %}
      <tr>
        <td>{{ machine.discord_name or '' }}</td>
        <td>{{ machine.hostname }}</td>
        <td>{{ machine.uuid }}</td>
        <td>{{ machine.tool_name }}</td>
        <td>
          <form action="{{ url_for('edit_expiry', uuid=machine.uuid, tool_name=machine.tool_name) }}" method="post">
            <input type="datetime-local" name="new_expiry_date" value="{{ machine.expiry_date.strftime('%Y-%m-%dT%H:%M') }}" required step="1" />
            <input type="text" name="discord_name" value="{{ machine.discord_name or '' }}" placeholder="Discord Name">
            <button type="submit">üíæ L∆∞u</button>
          </form>
        </td>
        <td>
          <span class="status-badge {% if machine.status == 'C√≤n h·∫°n' %} status-ok {% elif machine.status == 'H·∫øt h·∫°n' %} status-expired {% elif machine.status == 'Vƒ©nh vi·ªÖn' %} status-permanent {% endif %}">
            {{ machine.status }}
          </span>
        </td>
        <td>
          <a href="{{ url_for('delete_machine', uuid=machine.uuid, tool_name=machine.tool_name) }}">‚ùå X√≥a</a>
          |
          <a href="{{ url_for('set_permanent', uuid=machine.uuid, tool_name=machine.tool_name) }}">‚≠ê Vƒ©nh vi·ªÖn</a>
        </td>
      </tr>
      {% endfor %}
    </table>

    <h2>Th√™m m√°y m·ªõi (th·ªß c√¥ng)</h2>
    <form action="/add_machine" method="post">
      <input type="text" name="discord_name" placeholder="Discord Name (t√πy ch·ªçn)" />
      <input type="text" name="hostname" placeholder="Hostname" required />
      <input type="text" name="uuid" placeholder="UUID" required />
      <input type="text" name="tool_name" placeholder="T√™n Tool" required />
      <input type="datetime-local" name="expiry_date" required />
      <button type="submit">Th√™m m√°y</button>
    </form>

    <a href="/logout" style="float: right; margin-top: -40px; color: red; font-weight: bold">
      üëã ƒêƒÉng xu·∫•t
    </a>
  </body>
</html>
